version: "3.9"

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    expose:
      - "3001"
    environment:
      NODE_ENV: ${NODE_ENV:-production}
      PORT: 3001
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT:-3306}
      DB_USER: ${DB_USER:-root}
      DB_PASSWORD: ${DB_PASSWORD}
      DB_NAME: ${DB_NAME:-final}
      DB_DIALECT: mysql
      JWT_SECRET: ${JWT_SECRET}
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:3000}
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:3000}
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
      CLOUDINARY_CLOUD_NAME: ${CLOUDINARY_CLOUD_NAME}
      CLOUDINARY_API_KEY: ${CLOUDINARY_API_KEY}
      CLOUDINARY_API_SECRET: ${CLOUDINARY_API_SECRET}
      FIREBASE_SERVICE_ACCOUNT_PATH: ${FIREBASE_SERVICE_ACCOUNT_PATH:-./auction-adca9-77aeb27bd088.json}
      SOCKET_CORS_ORIGINS: ${SOCKET_CORS_ORIGINS:-${CORS_ORIGINS:-http://localhost:3000}}
    volumes:
      - ../files/auction-adca9-77aeb27bd088.json:/app/auction-adca9-77aeb27bd088.json:ro
    restart: unless-stopped
    networks:
      - dokploy-network
    # Traefik labels removed - use Dokploy UI Domains tab instead
    # Dokploy will automatically configure Traefik routing when domain is added via UI

networks:
  dokploy-network:
    external: true

